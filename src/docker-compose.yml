version: '3'
services:
  accounts-db:
    platform: linux/amd64
    build: ./accounts-db
    ports:
    - "5432:5432"

  userservice:
    platform: linux/amd64
    build: ./userservice
    ports:
    - "5000:5000"
    links:
    - accounts-db:accounts-db
    volumes:
      - type: volume
        source: keys
        target: /root/.ssh/
        read_only: true
    environment:
      VERSION: v0.5.0
      PORT: 5000
      ENABLE_TRACING: "true"
      TOKEN_EXPIRY_SECONDS: 3600
      PRIV_KEY_PATH: "/root/.ssh/privatekey"
      PUB_KEY_PATH: "/root/.ssh/publickey"
      SECRET: "test123"
      ACCOUNTS_DB_URI: "postgresql://accountsadmin:accountspwd@accounts-db:5432/accountsdb"
      BUDGETS_DB_URI: "postgresql://accountsadmin:accountspwd@accounts-db:5432/accountsdb"
      CATEGORIES_DB_URI: "postgresql://accountsadmin:accountspwd@accounts-db:5432/accountsdb"
    # Valid levels are debug, info, warning, error, critical. If no valid level is set, gunicorn will default to info.
      LOG_LEVEL: debug

  frontend:
    platform: linux/amd64
    build: ./frontend
    ports:
    - "5010:5010"
    links:
    - userservice:userservice
    volumes:
      - type: volume
        source: keys
        target: /root/.ssh/
        read_only: true
    environment:
      PRIV_KEY_PATH: "/root/.ssh/privatekey"
      PUB_KEY_PATH: "/root/.ssh/publickey"
      SECRET: "test123"
      VERSION: v0.1.0
      PORT: 5010
      ENABLE_TRACING: "true"
      TOKEN_EXPIRY_SECONDS: 3600
      USERSERVICE_API_ADDR: "userservice:5000"
      APP_NAME: "OneBudget"
    # Valid levels are debug, info, warning, error, critical. If no valid level is set, gunicorn will default to info.
      LOG_LEVEL: debug

volumes:
  keys:
